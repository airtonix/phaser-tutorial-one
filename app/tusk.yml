options:
  hmrport:
    default: 5678
    environment: HMR_PORT
  port:
    default: 1234
    environment: PORT
  host:
    default: 0.0.0.0
    environment: HOST

tasks:

  dev:
    run:
      - set-environment:
          PARCEL_AUTOINSTALL: false
      - >-
        npx parcel serve
        --host ${host}
        --hmr-port ${hmrport}
        --port ${port}
        ./src/index.html

  build:
    options:
      public_url:
        default: /
        usage: base url for published site
    run:
      - set-environment:
          PARCEL_AUTOINSTALL: false
      - >-
        npx parcel build
        --public-url=${public_url}
        ./src/index.html

  prepare:
    run:
      - >-
        export modules=(
          phaser3-rex-plugins/plugins/gameobjects/shape/roundrectangle/RoundRectangle
          phaser3-rex-plugins/templates/ui/numberbar/NumberBar
        );
        for module in ${modules[@]}; do
         output=$(basename $module);
         npx dtsmake \
          -s ./node_modules/$module.js \
          -e -S es6 -M "$module" \
          --dist $output;
        done;

  lint:
    run:
      - >-
        npx eslint
        ./src
        --ext .ts
        --cache

  lint:fix:
    run:
      - >-
        npx eslint
        ./src
        --ext .ts
        --cache
        --fix

  test:
    run:
      - >-
        npx jest
        --config ./jest.config.js
        --passWithNoTests
